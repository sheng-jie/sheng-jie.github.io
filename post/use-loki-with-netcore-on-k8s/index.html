<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="google-site-verification" content="XAIH4DrWi63t0tKRgnjNUqX_3iXwxdroiCfjrFl4ZH4" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="XAIH4DrWi63t0tKRgnjNUqX_3iXwxdroiCfjrFl4ZH4">
  <meta name="baidu-site-verification" content="Ih8zdGWlLG">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/blue/pace-theme-minimal.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.shengjie.dev","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"buttons","active":null,"storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="体验一把Loki，从此爱上她，忘了她(ELK&#x2F;EFK)！">
<meta property="og:type" content="article">
<meta property="og:title" content=".NET Core + K8S + Loki  玩转日志聚合">
<meta property="og:url" content="https://blog.shengjie.dev/post/use-loki-with-netcore-on-k8s/index.html">
<meta property="og:site_name" content="圣杰 | 知多少">
<meta property="og:description" content="体验一把Loki，从此爱上她，忘了她(ELK&#x2F;EFK)！">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.shengjie.dev/images/use-loki-with-netcore-on-k8s/2799767-8a2a9babaa4251ed.png">
<meta property="og:image" content="https://blog.shengjie.dev/images/use-loki-with-netcore-on-k8s/2799767-74a1d7b72766122c.png">
<meta property="og:image" content="https://blog.shengjie.dev/images/use-loki-with-netcore-on-k8s/2799767-1c28d06f48f9ee6c.png">
<meta property="og:image" content="https://blog.shengjie.dev/images/use-loki-with-netcore-on-k8s/2799767-54cdf8c248c39797.png">
<meta property="article:published_time" content="2020-07-26T06:24:48.000Z">
<meta property="article:modified_time" content="2021-06-02T05:16:49.840Z">
<meta property="article:author" content="圣杰">
<meta property="article:tag" content=".NET">
<meta property="article:tag" content="Loki">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.shengjie.dev/images/use-loki-with-netcore-on-k8s/2799767-8a2a9babaa4251ed.png">

<link rel="canonical" href="https://blog.shengjie.dev/post/use-loki-with-netcore-on-k8s/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>.NET Core + K8S + Loki  玩转日志聚合 | 圣杰 | 知多少</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">圣杰 | 知多少</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Code is cheap, show you my mind!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">28</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">5</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">32</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/sheng-jie" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.shengjie.dev/post/use-loki-with-netcore-on-k8s/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/MVP_Logo.bmp">
      <meta itemprop="name" content="圣杰">
      <meta itemprop="description" content="一名立志成为架构师并为之努力奋斗的程序员！">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="圣杰 | 知多少">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          .NET Core + K8S + Loki  玩转日志聚合
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-26 14:24:48" itemprop="dateCreated datePublished" datetime="2020-07-26T14:24:48+08:00">2020-07-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-02 13:16:49" itemprop="dateModified" datetime="2021-06-02T13:16:49+08:00">2021-06-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>
            <div class="post-description">体验一把Loki，从此爱上她，忘了她(ELK/EFK)！</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><img src="/images/use-loki-with-netcore-on-k8s/2799767-8a2a9babaa4251ed.png" alt="Grafana loki"></p>
<h1 id="1-Intro"><a href="#1-Intro" class="headerlink" title="1. Intro"></a>1. Intro</h1><p>最近在了解日志聚合系统，正好前几天看到一篇文章《<a href="https://www.ershicimi.com/p/a0747756a287962e76fe672d88c7f912" target="_blank" rel="noopener">用了日志系统新贵Loki，ELK突然不香了！</a>》，所以就决定动手体验一下。本文就带大家快速了解下Loki，并简单介绍.NET Core如何集成Loki。</p>
<h1 id="2-What’s-Loki-Stack"><a href="#2-What’s-Loki-Stack" class="headerlink" title="2. What’s Loki Stack"></a>2. What’s Loki Stack</h1><p><a href="https://github.com/grafana/loki" target="_blank" rel="noopener">Grafana Loki</a> like Prometheus, but for logs。其是一个水平可扩展，高可用性，多租户的<strong>日志聚合系统</strong>，基于Apatch 2.0开源。其有三部分组成：</p>
<ol>
<li>Loki 是主服务器，负责存储日志和处理查询。对标ELK中的ElasticSearch。</li>
<li>Promtail 是代理，负责收集日志并将其发送给loki。对标ELK中的Logstash。</li>
<li>Grafana提供用户界面。对标ELK中的Kibana。<br><img src="/images/use-loki-with-netcore-on-k8s/2799767-74a1d7b72766122c.png" alt=""></li>
</ol>
<h1 id="3-Why-Use-Loki"><a href="#3-Why-Use-Loki" class="headerlink" title="3. Why Use Loki"></a>3. Why Use Loki</h1><p>日志聚合系统的目的是为了方便我们进行日志跟踪和故障排查，尤其在云原生的环境之下。目前主流的日志聚合系统，当数ELK、EFK和Loki。Loki相较于ELK Stack有以下优势：</p>
<ul>
<li><p>Elasticsearch中的数据作为非结构化JSON对象存储在磁盘上，Loki以二进制的形式存储。</p>
</li>
<li><p>Elasticsearch采用全文索引，倒排索引的切分和共享的成本较高。Loki仅索引元数据，比如标签。</p>
</li>
<li><p>和Prometheus无缝集成。</p>
</li>
</ul>
<h1 id="4-How-Use-Loki"><a href="#4-How-Use-Loki" class="headerlink" title="4. How Use Loki"></a>4. How Use Loki</h1><p>首先我们先来基于Heml安装Loki到本地K8S集群。</p>
<p><strong>1. 添加Loki Chart 仓库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; helm repo add loki https:&#x2F;&#x2F;grafana.github.io&#x2F;loki&#x2F;charts</span><br><span class="line">&quot;loki&quot; has been added to your repositories</span><br><span class="line">PS C:\Users\Shengjie&gt; helm repo update</span><br><span class="line">Hang tight while we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the &quot;stable&quot; chart repository</span><br><span class="line">...Successfully got an update from the &quot;loki&quot; chart repository</span><br><span class="line">Update Complete. ⎈ Happy Helming!⎈</span><br></pre></td></tr></table></figure>
<p><strong>2. 安装Loki Stack</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; helm search hub loki-stack</span><br><span class="line">URL                                             CHART VERSION   APP VERSION     DESCRIPTION</span><br><span class="line">https:&#x2F;&#x2F;hub.helm.sh&#x2F;charts&#x2F;loki&#x2F;loki-stack      0.38.3          v1.5.0          Loki: like Prometheus, but for logs.</span><br><span class="line">PS C:\Users\Shengjie&gt; helm show values loki&#x2F;loki-stack</span><br><span class="line">loki:</span><br><span class="line">  enabled: true</span><br><span class="line"></span><br><span class="line">promtail:</span><br><span class="line">  enabled: true</span><br><span class="line"></span><br><span class="line">fluent-bit:</span><br><span class="line">  enabled: false</span><br><span class="line"></span><br><span class="line">grafana:</span><br><span class="line">  enabled: false</span><br><span class="line">  sidecar:</span><br><span class="line">    datasources:</span><br><span class="line">      enabled: true</span><br><span class="line">  image:</span><br><span class="line">    tag: 6.7.0</span><br><span class="line"></span><br><span class="line">prometheus:</span><br><span class="line">  enabled: false</span><br><span class="line"></span><br><span class="line">filebeat:</span><br><span class="line">  enabled: false</span><br><span class="line">  filebeatConfig:</span><br><span class="line">    filebeat.yml: |</span><br><span class="line">      # logging.level: debug</span><br><span class="line">      filebeat.inputs:</span><br><span class="line">      - type: container</span><br><span class="line">        paths:</span><br><span class="line">          - &#x2F;var&#x2F;log&#x2F;containers&#x2F;*.log</span><br><span class="line">        processors:</span><br><span class="line">        - add_kubernetes_metadata:</span><br><span class="line">            host: $&#123;NODE_NAME&#125;</span><br><span class="line">            matchers:</span><br><span class="line">            - logs_path:</span><br><span class="line">                logs_path: &quot;&#x2F;var&#x2F;log&#x2F;containers&#x2F;&quot;</span><br><span class="line">      output.logstash:</span><br><span class="line">        hosts: [&quot;logstash-loki:5044&quot;]</span><br><span class="line"></span><br><span class="line">logstash:</span><br><span class="line">  enabled: false</span><br><span class="line">  image:</span><br><span class="line">    repository: grafana&#x2F;logstash-output-loki</span><br><span class="line">    tag: 1.0.1</span><br><span class="line">  filters:</span><br><span class="line">    main: |-</span><br><span class="line">      filter &#123;</span><br><span class="line">        if [kubernetes] &#123;</span><br><span class="line">          mutate &#123;</span><br><span class="line">            add_field &#x3D;&gt; &#123;</span><br><span class="line">              &quot;container_name&quot; &#x3D;&gt; &quot;%&#123;[kubernetes][container][name]&#125;&quot;</span><br><span class="line">              &quot;namespace&quot; &#x3D;&gt; &quot;%&#123;[kubernetes][namespace]&#125;&quot;</span><br><span class="line">              &quot;pod&quot; &#x3D;&gt; &quot;%&#123;[kubernetes][pod][name]&#125;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            replace &#x3D;&gt; &#123; &quot;host&quot; &#x3D;&gt; &quot;%&#123;[kubernetes][node][name]&#125;&quot;&#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mutate &#123;</span><br><span class="line">          remove_field &#x3D;&gt; [&quot;tags&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  outputs:</span><br><span class="line">    main: |-</span><br><span class="line">      output &#123;</span><br><span class="line">        loki &#123;</span><br><span class="line">          url &#x3D;&gt; &quot;http:&#x2F;&#x2F;loki:3100&#x2F;loki&#x2F;api&#x2F;v1&#x2F;push&quot;</span><br><span class="line">          #username &#x3D;&gt; &quot;test&quot;</span><br><span class="line">          #password &#x3D;&gt; &quot;test&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        # stdout &#123; codec &#x3D;&gt; rubydebug &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>从上面的Values中，可以看出，可以自定义启用fluent-bit、grafana、filebeat、prometheus、logstash组件。这里我们仅启用grafana日志界面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; helm install loki-stack loki&#x2F;loki-stack --set grafana.enabled&#x3D;true</span><br><span class="line">coalesce.go:165: warning: skipped value for filters: Not a table.</span><br><span class="line">coalesce.go:165: warning: skipped value for filters: Not a table.</span><br><span class="line">NAME: loki-stack</span><br><span class="line">LAST DEPLOYED: Sun Jul 26 11:58:11 2020</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">NOTES:</span><br><span class="line">The Loki stack has been deployed to your cluster. Loki can now be added as a datasource in Grafana.</span><br><span class="line"></span><br><span class="line">See http:&#x2F;&#x2F;docs.grafana.org&#x2F;features&#x2F;datasources&#x2F;loki&#x2F; for more detail.</span><br></pre></td></tr></table></figure>
<p><strong>3. 登录Grafana</strong><br>首先确认Loki是否成功部署：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; helm list</span><br><span class="line">NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION</span><br><span class="line">loki-stack      default         1               2020-07-26 11:58:11.022896 +0800 CST    deployed        loki-stack-0.38.3       v1.5.0</span><br><span class="line">PS C:\Users\Shengjie&gt; kubectl get pod -w</span><br><span class="line">NAME                                READY   STATUS        RESTARTS   AGE</span><br><span class="line">loki-stack-0                        1&#x2F;1     Running       0          2m33s</span><br><span class="line">loki-stack-grafana-c447cfbd-z6tbg   1&#x2F;1     Running       0          2m33s</span><br><span class="line">loki-stack-promtail-j47hl           1&#x2F;1     Running       0          2m33s</span><br><span class="line">PS C:\Users\Shengjie&gt; kubectl get svc -w</span><br><span class="line">NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">kubernetes            ClusterIP   10.96.0.1       &lt;none&gt;        443&#x2F;TCP    56d</span><br><span class="line">loki-stack            ClusterIP   10.110.83.209   &lt;none&gt;        3100&#x2F;TCP   2m52s</span><br><span class="line">loki-stack-grafana    ClusterIP   10.111.24.26    &lt;none&gt;        80&#x2F;TCP     2m52s</span><br><span class="line">loki-stack-headless   ClusterIP   None            &lt;none&gt;        3100&#x2F;TCP   2m52s</span><br></pre></td></tr></table></figure>
<p>从上面可知，已经成功启动，其中loki暴露的容器端口为3100，grafana暴露的端口为80。<br>因此我们下一步需要进行端口转发，才能访问grafana。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; kubectl port-forward svc&#x2F;loki-stack-grafana 3000:80</span><br><span class="line">Forwarding from 127.0.0.1:3000 -&gt; 3000</span><br><span class="line">Forwarding from [::1]:3000 -&gt; 3000</span><br></pre></td></tr></table></figure>
<p>然后本地浏览器打开<a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000/</a>就可以访问了。<br>其默认用户是admin，默认密码在哪里呢，别慌，我们去看下loki-stack chart 的readme：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; helm show readme loki&#x2F;loki-stack</span><br><span class="line"># Loki-Stack Helm Chart</span><br><span class="line">## Prerequisites</span><br><span class="line"></span><br><span class="line">Make sure you have Helm [installed](https:&#x2F;&#x2F;helm.sh&#x2F;docs&#x2F;using_helm&#x2F;#installing-helm) and</span><br><span class="line">[deployed](https:&#x2F;&#x2F;helm.sh&#x2F;docs&#x2F;using_helm&#x2F;#installing-tiller) to your cluster. Then add</span><br><span class="line">Loki&#39;s chart repository to Helm:</span><br><span class="line">$ helm repo add loki https:&#x2F;&#x2F;grafana.github.io&#x2F;loki&#x2F;charts</span><br><span class="line"></span><br><span class="line">You can update the chart repository by running:</span><br><span class="line">$ helm repo update</span><br><span class="line"></span><br><span class="line">## Deploy Loki and Promtail to your cluster</span><br><span class="line">### Deploy with default config</span><br><span class="line">$ helm upgrade --install loki loki&#x2F;loki-stack</span><br><span class="line">### Deploy in a custom namespace</span><br><span class="line">$ helm upgrade --install loki --namespace&#x3D;loki-stack loki&#x2F;loki-stack</span><br><span class="line"></span><br><span class="line">### Deploy with custom config</span><br><span class="line"></span><br><span class="line">$ helm upgrade --install loki loki&#x2F;loki-stack --set &quot;key1&#x3D;val1,key2&#x3D;val2,...&quot;</span><br><span class="line">## Deploy Loki and Fluent Bit to your cluster</span><br><span class="line">$ helm upgrade --install loki loki&#x2F;loki-stack \</span><br><span class="line">    --set fluent-bit.enabled&#x3D;true,promtail.enabled&#x3D;false</span><br><span class="line">## Deploy Grafana to your cluster</span><br><span class="line">The chart loki-stack contains a pre-configured Grafana, simply use &#96;--set grafana.enabled&#x3D;true&#96;</span><br><span class="line"></span><br><span class="line">To get the admin password for the Grafana pod, run the following command:</span><br><span class="line">$ kubectl get secret --namespace &lt;YOUR-NAMESPACE&gt; loki-grafana -o jsonpath&#x3D;&quot;&#123;.data.admin-password&#125;&quot; | base64 --decode ; echo</span><br><span class="line">To access the Grafana UI, run the following command:</span><br><span class="line">$ kubectl port-forward --namespace &lt;YOUR-NAMESPACE&gt; service&#x2F;loki-grafana 3000:80</span><br><span class="line">Navigate to http:&#x2F;&#x2F;localhost:3000 and login with &#96;admin&#96; and the password output above.</span><br><span class="line">Then follow the [instructions for adding the loki datasource](&#x2F;docs&#x2F;getting-started&#x2F;grafana.md), using the URL &#96;http:&#x2F;&#x2F;loki:3100&#x2F;&#96;</span><br></pre></td></tr></table></figure>
<p>上面已经说了很清楚了，可以从secret中获取。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">如果在windows powersheel中执行，需要分两步：</span><br><span class="line">1. 先获取base64加密的密码</span><br><span class="line">PS C:\Users\Shengjie&gt; $pwd&#x3D; kubectl get secret --namespace default loki-stack-grafana -o jsonpath&#x3D;&quot;&#123;.data.admin-password&#125;&quot;</span><br><span class="line">2. decode base64</span><br><span class="line">PS C:\Users\Shengjie&gt; [Text.Encoding]::Utf8.GetString([Convert]::FromBase64String($pwd))</span><br><span class="line">CjnbkkQmwQynZ96gCsynSf0elYQLOp4dyuDnp9jJ</span><br><span class="line"></span><br><span class="line">------------------------</span><br><span class="line">Linux命令行执行：</span><br><span class="line">shengjie@Thinkpad:&#x2F;mnt&#x2F;c&#x2F;Users&#x2F;Shengjie$ kubectl get secret --namespace default loki-stack-grafana -o jsonpath&#x3D;&quot;&#123;.data.admin-password&#125;&quot; | base64 --decode ; echo</span><br><span class="line">CjnbkkQmwQynZ96gCsynSf0elYQLOp4dyuDnp9jJ</span><br></pre></td></tr></table></figure>
<p>然后使用<code>admin/CjnbkkQmwQynZ96gCsynSf0elYQLOp4dyuDnp9jJ</code>即可成功登录<a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a>。</p>
<p><img src="/images/use-loki-with-netcore-on-k8s/2799767-1c28d06f48f9ee6c.png" alt="Grafnan Explore"></p>
<h1 id="5-Use-Loki-With-NET-Core"><a href="#5-Use-Loki-With-NET-Core" class="headerlink" title="5. Use Loki With .NET Core"></a>5. Use Loki With .NET Core</h1><p>下一步，我们就来创建一个ASP.NET Core Web 应用，将日志记录到Loki，并通过Grafana进行聚合分析。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie&gt; dotnet new web -n Loki.K8s.Demo</span><br><span class="line">The template &quot;ASP.NET Core Empty&quot; was created successfully.</span><br><span class="line"></span><br><span class="line">Processing post-creation actions...</span><br><span class="line">Running &#39;dotnet restore&#39; on Loki.K8s.Demo\Loki.K8s.Demo.csproj...</span><br><span class="line">  Determining projects to restore...</span><br><span class="line">  Restored C:\Users\Shengjie\Loki.K8s.Demo\Loki.K8s.Demo.csproj (in 150 ms).</span><br><span class="line"></span><br><span class="line">Restore succeeded.</span><br><span class="line">PS C:\Users\Shengjie&gt; cd .\Loki.K8s.Demo\</span><br><span class="line"># 添加Serilog.AspNetCore和Serilog.Sinks.Loki Nuget包。</span><br><span class="line">PS C:\Users\Shengjie\Loki.K8s.Demo&gt; dotnet add package Serilog.AspNetCore</span><br><span class="line">PS C:\Users\Shengjie\Loki.K8s.Demo&gt; dotnet add package Serilog.Sinks.Loki</span><br></pre></td></tr></table></figure>
<p>从上可知，日志组件选用的是Serilog，因为其支持持久化日志到Loki。<br>修改<code>Program.cs</code>如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public static IHostBuilder CreateHostBuilder(string[] args) &#x3D;&gt;</span><br><span class="line">    Host.CreateDefaultBuilder(args)</span><br><span class="line">        .ConfigureWebHostDefaults(webBuilder &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            webBuilder.UseStartup&lt;Startup&gt;();</span><br><span class="line">        &#125;).UseSerilog((ctx, cfg) &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F;cfg.MinimumLevel.Override(&quot;Microsoft&quot;, LogEventLevel.Warning);&#x2F;&#x2F;Microsoft框架本身的日志，仅输出Warning以上级别</span><br><span class="line">            cfg.Enrich.FromLogContext()</span><br><span class="line">            .Enrich.WithProperty(&quot;App&quot;, ctx.HostingEnvironment.ApplicationName)</span><br><span class="line">            .Enrich.WithProperty(&quot;ENV&quot;, ctx.HostingEnvironment.EnvironmentName)</span><br><span class="line">            .WriteTo.LokiHttp(new NoAuthCredentials(&quot;http:&#x2F;&#x2F;localhost:3100&quot;))&#x2F;&#x2F;配置Loki Url和认证方式</span><br><span class="line">            .WriteTo.Console();</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>修改<code>Startup.cs</code>的<code>Configure</code>方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public void Configure(IApplicationBuilder app, IWebHostEnvironment env,ILogger&lt;Startup&gt; logger)</span><br><span class="line">&#123;</span><br><span class="line">    if (env.IsDevelopment())</span><br><span class="line">    &#123;</span><br><span class="line">        app.UseDeveloperExceptionPage();</span><br><span class="line">    &#125;</span><br><span class="line">    app.UseRouting();</span><br><span class="line">    app.UseEndpoints(endpoints &#x3D;&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        endpoints.MapGet(&quot;&#x2F;&quot;, async context &#x3D;&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            logger.LogInformation(&quot;start handle request!&quot;);</span><br><span class="line">            await context.Response.WriteAsync(&quot;Hello World!&quot;);</span><br><span class="line">            logger.LogInformation(&quot;end handle request!&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为不想把应用打包成镜像运行到K8S中，所以我们需要把K8S的Loki服务做一次端口转发暴露到本机，转发后，就可以使用<code>http://localhost:3100</code>作为Loki的Url进行日志写入啦。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Shengjie\Loki.K8s.Demo&gt; kubectl port-forward svc&#x2F;loki-stack 3100:3100</span><br><span class="line">Forwarding from 127.0.0.1:3100 -&gt; 3100</span><br><span class="line">Forwarding from [::1]:3100 -&gt; 3100</span><br></pre></td></tr></table></figure>
<p>运行项目后，重新打开Grafana，添加过滤条件，就可以查看应用日志了。</p>
<p><img src="/images/use-loki-with-netcore-on-k8s/2799767-54cdf8c248c39797.png" alt=""></p>
<blockquote>
<p>参考资料：</p>
<ol>
<li><a href="https://cloud.tencent.com/developer/article/1622402" target="_blank" rel="noopener">日志聚合工具loki</a></li>
<li><a href="https://blog.csdn.net/linkthaha/category_9331298.html" target="_blank" rel="noopener">CSDN-linkt1234-Loki</a></li>
<li><a href="https://grafana.com/docs/loki/latest/" target="_blank" rel="noopener">Loki官方文档</a></li>
</ol>
</blockquote>

    </div>

    
    
    
      
  <div class="popular-posts-header">猜你喜欢</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/post/eshoponcontainers-basket-microservice-7/" rel="bookmark">eShopOnContainers 知多少[7]：Basket microservice</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/post/eshoponcontainers-catalog-microservice-4/" rel="bookmark">eShopOnContainers 知多少[4]：Catalog microservice</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="/post/eshoponcontainers-communication-with-grpc-11/" rel="bookmark">eShopOnContainers 知多少[11]：服务间通信之gRPC</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>圣杰
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://blog.shengjie.dev/post/use-loki-with-netcore-on-k8s/" title=".NET Core + K8S + Loki  玩转日志聚合">https://blog.shengjie.dev/post/use-loki-with-netcore-on-k8s/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>扫码关注我的公众号-「微服务知多少」</p>

    <div class="social-list">

        <div class="social-item">
          <img src="/images/subscribe-dotnet-microservices.png" alt="">
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/NET/" rel="tag"><i class="fa fa-tag"></i> .NET</a>
              <a href="/tags/Loki/" rel="tag"><i class="fa fa-tag"></i> Loki</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/use-apollo-with-netcore-on-k8s/" rel="prev" title=".NET Core + K8S + Apollo 玩转配置中心">
      <i class="fa fa-chevron-left"></i> .NET Core + K8S + Apollo 玩转配置中心
    </a></div>
      <div class="post-nav-item">
    <a href="/post/build-your-first-serverless-free-email-service-with-azure-function/" rel="next" title="五分钟快速搭建Serverless免费邮件服务">
      五分钟快速搭建Serverless免费邮件服务 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ol class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ol>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-Intro"><span class="nav-text">1. Intro</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-What’s-Loki-Stack"><span class="nav-text">2. What’s Loki Stack</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-Why-Use-Loki"><span class="nav-text">3. Why Use Loki</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-How-Use-Loki"><span class="nav-text">4. How Use Loki</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-Use-Loki-With-NET-Core"><span class="nav-text">5. Use Loki With .NET Core</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="圣杰"
      src="/images/MVP_Logo.bmp">
  <p class="site-author-name" itemprop="name">圣杰</p>
  <div class="site-description" itemprop="description">一名立志成为架构师并为之努力奋斗的程序员！</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/sheng-jie" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;sheng-jie" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/shengjie_yan@live.com" title="E-Mail → shengjie_yan@live.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/39ec0e6b1844" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;39ec0e6b1844" rel="noopener" target="_blank"><i class="fa fa-fw fa-paper-plane"></i>简书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://sheng-jie.cnblogs.com/" title="博客园 → https:&#x2F;&#x2F;sheng-jie.cnblogs.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-tree"></i>博客园</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-copyright"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">圣杰</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">300k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:33</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script data-pjax>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

    </div>
</body>
</html>
